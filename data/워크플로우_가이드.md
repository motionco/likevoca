# LikeVoca 데이터 워크플로우 가이드

## 🚀 빠른 시작 - 현재 시스템

### 완전한 워크플로우 (권장)
```bash
# 1. 데이터 생성 (58개 필드, 모든 필드 완성)
python generate.py

# 2. 완전한 검증 (중복/완성도/무결성/포맷)
python validate.py

# 3. 데이터 누적 (_add.csv → _list.csv)
python accumulator.py

# 4. 백업 생성
python backup.py
```

### 백업 복원 (필요시)
```bash
python restore.py  # 시점별 백업 목록에서 선택
```

## 📁 파일 구조

### 작업 파일 (Staging)
- `concepts_template_add.csv` - 새로 생성된 개념 데이터 (58개 필드)
- `examples_template_add.csv` - 새로 생성된 예문 데이터 (16개 필드)
- `grammar_template_add.csv` - 새로 생성된 문법 데이터 (31개 필드)

### 누적 파일 (Production)
- `concepts_template_list.csv` - 누적된 개념 데이터
- `examples_template_list.csv` - 누적된 예문 데이터
- `grammar_template_list.csv` - 누적된 문법 데이터

### 백업 폴더
- `backup/backup_YYYYMMDD_HHMMSS/` - 시간별 백업 폴더

## 🔧 각 단계 설명

### 1단계: 데이터 생성 (`python generate.py`)
- **58개 필드** 완전한 Concepts 템플릿 생성
- **모든 필드 자동 완성**: synonym, antonym, word_family, compound_words, collocations
- **중복 방지**: concept_id 및 단어+의미 조합 중복 검사
- **다의어 처리**: 다른 도메인/카테고리면 동일 단어 허용
- **결과**: 3개 `_add.csv` 파일 생성

### 2단계: 데이터 검증 (`python validate.py`)
- **중복 검사**: concept_id 및 단어+의미 조합 중복 확인
- **필드 완성도**: 모든 필드 데이터 존재 여부 확인
- **데이터 무결성**: 형식 및 구조 검증
- **포맷 검증**: CSV 형식 및 인코딩 검증

### 3단계: 데이터 누적 (`python accumulator.py`)
- **데이터 이동**: `_add.csv` → `_list.csv`
- **중복 제거**: concept_id 및 단어+의미 조합 기준으로 중복 제거
- **상태 확인**: 파일별 데이터 개수 표시

### 4단계: 백업 생성 (`python backup.py`)
- **전체 백업**: 모든 CSV 파일을 시간별 폴더에 저장
- **자동 타임스탬프**: `backup_YYYYMMDD_HHMMSS` 형식

### 복원 기능 (`python restore.py`)
- **백업 목록**: 사용 가능한 모든 백업 표시
- **선택 복원**: 원하는 시점의 백업 선택
- **자동 감지**: VS Code 새로고침 없이 파일 변경 감지

## ⚠️ 중요 사항

### 올바른 실행 순서
1. ✅ `generate.py` → `validate.py` → `accumulator.py` → `backup.py`
2. ❌ 순서 변경 시 데이터 무결성 문제 발생 가능

### 백업 관리
- **정기 백업**: 대량 데이터 생성 전 반드시 백업 생성
- **복원 주의**: 복원 시 현재 데이터가 완전히 덮어써짐

### 파일 관리
- **작업 파일**: `_add.csv` 파일은 임시 파일 (매번 새로 생성)
- **누적 파일**: `_list.csv` 파일은 영구 저장소 (계속 누적)

## 💡 중복 검사 시스템

### 전체 단계에서 작동하는 이중 중복 검사

**1. concept_id 중복 검사**
- 형식: `{domain}_{word}_{meaning}` (예: `food_apple_fruit`)
- 각 concept_id는 시스템 전체에서 고유해야 함

**2. 단어+의미 조합 중복 검사**
- `{english_word}_{meaning}` 조합 중복 방지
- `{korean_word}_{meaning}` 조합 중복 방지
- **목적**: 진짜 다의어만 허용하고 동일 의미 중복 차단

**적용 단계:**
- ✅ **1단계** (`generate.py`): 생성 시점에 중복 방지
- ✅ **2단계** (`validate.py`): 검증 시점에 중복 감지
- ✅ **3단계** (`accumulator.py`): 누적 시점에 최종 차단

**다의어 예시:**
- ✅ **허용**: `food_apple_fruit` + `technology_apple_company` (다른 의미)
- ❌ **차단**: `food_apple_fruit` + `nature_apple_fruit` (같은 의미)

## 💡 문제 해결

### 복원이 VS Code에서 반영되지 않을 때
- 현재 시스템은 자동 파일 감지가 개선되어 새로고침 불필요
- 여전히 문제 시: `Ctrl + Shift + P` → "Developer: Reload Window"

### 검증 실패 시
- `python validate.py` 실행하여 구체적인 오류 확인
- 중복 데이터나 누락 필드 수정 후 재실행

### 데이터 손실 시
- `python restore.py` 실행하여 이전 백업으로 복원
- 정기 백업의 중요성

## 🔗 추가 자료

- **비개발자 가이드**: `../EASY_GUIDE.md`
- **상세 기술 문서**: `통합_데이터_가이드.md`
- **데이터 트랜잭션 로그**: `data_tracking_log.json`
- **아키텍처**: `../docs/architecture_recommendation.md`
