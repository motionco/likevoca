<nav class="bg-[#4B63AC] p-4 shadow-md">
  <div class="container mx-auto flex justify-between items-center max-w-6xl">
    <!-- 左側: ハンバーガーメニュー (モバイル) + ロゴ -->
    <div class="flex items-center">
      <button id="menu-toggle" class="text-white text-2xl lg:hidden mr-3">
        <i class="fa-solid fa-bars"></i>
      </button>

      <a
        href="index.html"
        class="text-white text-xl md:text-2xl lg:text-3xl font-bold"
        >LikeVoca</a
      >
    </div>

    <!-- 中央: ナビゲーションメニュー (デスクトップのみ) -->
    <ul id="nav-menu" class="hidden lg:flex space-x-10 items-center">
      <li>
        <a
          href="vocabulary.html"
          class="text-xl text-white hover:text-yellow-400"
          >単語帳</a
        >
      </li>
      <li>
        <a
          href="ai-vocabulary.html"
          class="text-xl text-white hover:text-yellow-400"
          >AI単語帳</a
        >
      </li>
      <li>
        <a href="learning.html" class="text-xl text-white hover:text-yellow-400"
          >学習</a
        >
      </li>
      <li>
        <a href="quiz.html" class="text-xl text-white hover:text-yellow-400"
          >クイズ</a
        >
      </li>
      <li>
        <a href="games.html" class="text-xl text-white hover:text-yellow-400"
          >ゲーム</a
        >
      </li>
      <li>
        <a href="progress.html" class="text-xl text-white hover:text-yellow-400"
          >進捗</a
        >
      </li>
      <li>
        <a href="inquiry.html" class="text-xl text-white hover:text-yellow-400"
          >お問い合わせ</a
        >
      </li>
    </ul>

    <!-- 右側: 言語設定 + ログイン/会員登録ボタン + ユーザープロフィール -->
    <div class="flex items-center space-x-1.5 lg:space-x-3">
      <!-- 言語設定ボタン (レスポンシブ) -->
      <button
        id="language-button"
        class="text-white font-semibold transition duration-300 hover:text-yellow-400 text-xl lg:text-base p-2 lg:p-2"
      >
        <i class="fas fa-globe lg:mr-1"></i>
        <span class="hidden lg:inline lg:ml-1">🇯🇵</span>
      </button>

      <!-- ログイン/会員登録ボタン (ログイン前) -->
      <div id="desktop-login-section" class="hidden space-x-2">
        <a
          href="#"
          id="login-button"
          onclick="goToLanguageSpecificPage('login.html')"
          class="border-2 border-white bg-[#4B63AC] text-white font-semibold px-4 py-1.5 text-sm rounded-lg hover:bg-white hover:text-[#4B63AC] transition duration-300"
          >ログイン</a
        >
        <a
          href="#"
          id="signup-button"
          onclick="goToLanguageSpecificPage('signup.html')"
          class="hidden lg:inline-block border-2 border-white bg-white text-[#4B63AC] font-semibold px-4 py-1.5 text-sm rounded-lg hover:bg-[#4B63AC] hover:text-white transition duration-300"
          >会員登録</a
        >
      </div>

      <!-- ユーザープロフィール (レスポンシブ) -->
      <div id="desktop-user-section" class="hidden">
        <div id="user-profile" class="relative flex items-center text-white">
          <div id="avatar-container" class="cursor-pointer">
            <div
              id="avatar"
              class="w-8 h-8 lg:w-10 lg:h-10 rounded-full overflow-hidden border-2 border-white"
            >
              <img
                id="profile-image"
                src=""
                alt="プロフィール"
                class="w-full h-full object-cover"
              />
            </div>
          </div>

          <div
            id="profile-dropdown"
            class="hidden absolute top-12 right-0 bg-white shadow-lg rounded-lg py-2 w-48 text-gray-900 z-50"
          >
            <div class="px-4 py-2 font-semibold border-b border-gray-200">
              <span id="user-name"></span>
            </div>
            <a
              href="my-word-list.html"
              class="block w-full text-left px-4 py-2 hover:bg-gray-100"
            >
              私の単語帳
            </a>
            <a
              href="profile.html"
              class="block w-full text-left px-4 py-2 hover:bg-gray-100"
            >
              プロフィール
            </a>
            <button
              id="logout-button"
              class="block w-full text-left px-4 py-2 hover:bg-gray-100"
            >
              ログアウト
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div
    id="mobile-menu"
    class="hidden flex flex-col items-center space-y-4 bg-[#4B63AC] text-white p-3 lg:hidden"
  >
    <a href="vocabulary.html" class="text-lg hover:text-yellow-400">単語帳</a>
    <a href="ai-vocabulary.html" class="text-lg hover:text-yellow-400"
      >AI単語帳</a
    >
    <a href="learning.html" class="text-lg hover:text-yellow-400">学習</a>
    <a href="quiz.html" class="text-lg hover:text-yellow-400">クイズ</a>
    <a href="games.html" class="text-lg hover:text-yellow-400">ゲーム</a>
    <a href="progress.html" class="text-lg hover:text-yellow-400">進捗</a>
    <a href="inquiry.html" class="text-lg hover:text-yellow-400"
      >お問い合わせ</a
    >

    <!-- モバイルログインボタン -->
    <div id="mobile-login-buttons" class="hidden flex space-x-3">
      <a
        href="#"
        onclick="goToLanguageSpecificPage('login.html')"
        class="border-2 border-white bg-[#4B63AC] text-white font-semibold px-5 py-2 text-sm rounded-lg hover:bg-white hover:text-[#4B63AC] transition duration-300"
        >ログイン</a
      >
      <a
        href="#"
        onclick="goToLanguageSpecificPage('signup.html')"
        class="border-2 border-white bg-[#4B63AC] text-white font-semibold px-5 py-2 text-sm rounded-lg hover:bg-white hover:text-[#4B63AC] transition duration-300"
        >サインアップ</a
      >
    </div>
  </div>
</nav>

<script>
  // 開発環境の検知
  function isDevelopment() {
    return (
      window.location.hostname === "localhost" ||
      window.location.hostname === "127.0.0.1" ||
      window.location.port === "5595"
    );
  }

  // 현재 언어 감지
  function getCurrentLanguage() {
    const path = window.location.pathname;
    const langMatch = path.match(/\/(ko|en|ja|zh)\//);
    return langMatch ? langMatch[1] : "ko";
  }

  // 페이지 이동 함수
  function goToPage(filename) {
    const currentLang = getCurrentLanguage();

    if (isDevelopment()) {
      window.location.href = `/locales/${currentLang}/${filename}`;
    } else {
      window.location.href = `/${currentLang}/${filename}`;
    }
  }

  // 홈으로 이동
  function goToHome() {
    const currentLang = getCurrentLanguage();

    if (isDevelopment()) {
      window.location.href = `/locales/${currentLang}/index.html`;
    } else {
      window.location.href = `/${currentLang}/index.html`;
    }
  }

  // 루트 파일로 이동 (로그인, 회원가입, 프로필)
  function goToRoot(filename) {
    window.location.href = `/${filename}`;
  }

  // 言語別ページへの移動関数
  function goToLanguageSpecificPage(filename) {
    const userLanguage = localStorage.getItem("userLanguage") || "ko";
    const isDev =
      window.location.hostname === "localhost" ||
      window.location.hostname === "127.0.0.1" ||
      window.location.port === "5595";

    if (isDev) {
      window.location.href = `/locales/${userLanguage}/${filename}`;
    } else {
      window.location.href = `/${userLanguage}/${filename}`;
    }
  }

  // ナビゲーションバーの初期化関数
  function initializeNavbar() {
    // navbar.jsの初期化関数がすでにロードされているか確認
    if (typeof window.setupNavbarAuth === "function") {
      window.setupNavbarAuth();
    }

    if (typeof window.setupNavbarEvents === "function") {
      window.setupNavbarEvents();
    }
  }

  // DOMがロードされた後の初期化
  document.addEventListener("DOMContentLoaded", function () {
    initializeNavbar();
  });
</script>
