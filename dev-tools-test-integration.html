<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>다국어 콘텐츠 관리 시스템 테스트</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-4xl font-bold text-center mb-12 text-gray-800">
            <i class="fas fa-flask text-blue-600 mr-3"></i>
            다국어 콘텐츠 관리 시스템 테스트
        </h1>

        <!-- 테스트 결과 요약 -->
        <div id="testSummary" class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-semibold mb-4">
                <i class="fas fa-chart-bar text-green-600 mr-2"></i>
                테스트 결과 요약
            </h2>
            <div class="grid grid-cols-3 gap-4 text-center">
                <div class="bg-green-100 rounded-lg p-4">
                    <div class="text-3xl font-bold text-green-600" id="passedTests">0</div>
                    <div class="text-green-700">통과</div>
                </div>
                <div class="bg-red-100 rounded-lg p-4">
                    <div class="text-3xl font-bold text-red-600" id="failedTests">0</div>
                    <div class="text-red-700">실패</div>
                </div>
                <div class="bg-blue-100 rounded-lg p-4">
                    <div class="text-3xl font-bold text-blue-600" id="totalTests">0</div>
                    <div class="text-blue-700">전체</div>
                </div>
            </div>
        </div>

        <!-- 테스트 카테고리 -->
        <div class="space-y-8">
            <!-- 1. 관리자 콘텐츠 관리 시스템 테스트 -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold mb-4">
                    <i class="fas fa-cog text-purple-600 mr-2"></i>
                    1. 관리자 콘텐츠 관리 시스템
                </h3>
                <div id="adminTests" class="space-y-2">
                    <!-- 테스트 결과가 여기에 동적으로 추가됩니다 -->
                </div>
                <button onclick="runAdminTests()" class="mt-4 bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700">
                    <i class="fas fa-play mr-2"></i>
                    관리자 시스템 테스트 실행
                </button>
            </div>

            <!-- 2. 콘텐츠 통합 시스템 테스트 -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold mb-4">
                    <i class="fas fa-puzzle-piece text-orange-600 mr-2"></i>
                    2. 콘텐츠 통합 시스템
                </h3>
                <div id="integrationTests" class="space-y-2">
                    <!-- 테스트 결과가 여기에 동적으로 추가됩니다 -->
                </div>
                <button onclick="runIntegrationTests()" class="mt-4 bg-orange-600 text-white px-6 py-2 rounded-lg hover:bg-orange-700">
                    <i class="fas fa-play mr-2"></i>
                    통합 시스템 테스트 실행
                </button>
            </div>

            <!-- 3. 실시간 동기화 테스트 -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold mb-4">
                    <i class="fas fa-sync-alt text-blue-600 mr-2"></i>
                    3. 실시간 동기화 시스템
                </h3>
                <div id="syncTests" class="space-y-2">
                    <!-- 테스트 결과가 여기에 동적으로 추가됩니다 -->
                </div>
                <button onclick="runSyncTests()" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                    <i class="fas fa-play mr-2"></i>
                    동기화 테스트 실행
                </button>
            </div>

            <!-- 4. 다국어 지원 테스트 -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold mb-4">
                    <i class="fas fa-globe text-green-600 mr-2"></i>
                    4. 다국어 지원 시스템
                </h3>
                <div id="languageTests" class="space-y-2">
                    <!-- 테스트 결과가 여기에 동적으로 추가됩니다 -->
                </div>
                <button onclick="runLanguageTests()" class="mt-4 bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">
                    <i class="fas fa-play mr-2"></i>
                    다국어 테스트 실행
                </button>
            </div>
        </div>

        <!-- 전체 테스트 실행 버튼 -->
        <div class="text-center mt-8">
            <button onclick="runAllTests()" class="bg-gray-800 text-white px-12 py-4 rounded-lg text-lg font-semibold hover:bg-gray-900">
                <i class="fas fa-rocket mr-2"></i>
                전체 테스트 실행
            </button>
        </div>

        <!-- 테스트 로그 -->
        <div class="bg-black text-green-400 rounded-lg p-4 mt-8 font-mono text-sm">
            <div class="flex items-center justify-between mb-2">
                <h4 class="font-bold">테스트 로그</h4>
                <button onclick="clearLog()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-trash mr-1"></i>
                    지우기
                </button>
            </div>
            <div id="testLog" class="max-h-96 overflow-y-auto">
                <div class="text-gray-500">테스트 로그가 여기에 표시됩니다...</div>
            </div>
        </div>
    </div>

    <script type="module">
        // 테스트 상태 변수
        let testResults = {
            passed: 0,
            failed: 0,
            total: 0
        };

        // 로그 함수
        function log(message, type = 'info') {
            const logDiv = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: 'text-green-400',
                success: 'text-green-300',
                error: 'text-red-400',
                warning: 'text-yellow-400'
            };
            
            logDiv.innerHTML += `<div class="${colors[type]}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // 테스트 결과 추가
        function addTestResult(container, testName, passed, details = '') {
            const resultDiv = document.createElement('div');
            resultDiv.className = `flex items-center justify-between p-3 rounded-lg ${passed ? 'bg-green-50 text-green-800' : 'bg-red-50 text-red-800'}`;
            
            resultDiv.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${passed ? 'check' : 'times'} mr-2"></i>
                    <span>${testName}</span>
                </div>
                <div class="text-sm">${details}</div>
            `;
            
            container.appendChild(resultDiv);
            
            // 결과 업데이트
            if (passed) {
                testResults.passed++;
                log(`✅ ${testName} - 통과 ${details ? '(' + details + ')' : ''}`, 'success');
            } else {
                testResults.failed++;
                log(`❌ ${testName} - 실패 ${details ? '(' + details + ')' : ''}`, 'error');
            }
            testResults.total++;
            updateSummary();
        }

        // 요약 업데이트
        function updateSummary() {
            document.getElementById('passedTests').textContent = testResults.passed;
            document.getElementById('failedTests').textContent = testResults.failed;
            document.getElementById('totalTests').textContent = testResults.total;
        }

        // 1. 관리자 시스템 테스트
        window.runAdminTests = async function() {
            const container = document.getElementById('adminTests');
            container.innerHTML = '';
            log('🚀 관리자 콘텐츠 관리 시스템 테스트 시작', 'info');

            try {
                // 로컬 스토리지 테스트
                localStorage.setItem('test_multilingual_content', JSON.stringify([{
                    id: 'test-content-1',
                    type: 'faq',
                    priority: 'high',
                    versions: {
                        ko: { title: '테스트 질문', content: '테스트 답변', published: true, translationStatus: 'updated' }
                    }
                }]));
                addTestResult(container, '로컬 스토리지 저장/읽기', true, '테스트 콘텐츠 저장 성공');

                // 다국어 콘텐츠 생성 테스트
                const testContent = {
                    id: 'test-multilang-1',
                    type: 'manual',
                    priority: 'medium',
                    versions: {
                        ko: { title: '한국어 제목', content: '한국어 내용', published: true, translationStatus: 'updated' },
                        en: { title: 'English Title', content: 'English Content', published: true, translationStatus: 'updated' }
                    },
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                addTestResult(container, '다국어 콘텐츠 구조 검증', 
                    Object.keys(testContent.versions).length >= 2, 
                    `${Object.keys(testContent.versions).length}개 언어`);

                // 번역 상태 관리 테스트
                const translationStatuses = ['updated', 'outdated', 'missing'];
                const validStatus = translationStatuses.includes(testContent.versions.ko.translationStatus);
                addTestResult(container, '번역 상태 관리', validStatus, testContent.versions.ko.translationStatus);

            } catch (error) {
                addTestResult(container, '관리자 시스템 오류', false, error.message);
            }
        };

        // 2. 콘텐츠 통합 시스템 테스트
        window.runIntegrationTests = async function() {
            const container = document.getElementById('integrationTests');
            container.innerHTML = '';
            log('🔗 콘텐츠 통합 시스템 테스트 시작', 'info');

            try {
                // ContentIntegration 클래스 테스트
                const { ContentIntegration } = await import('./js/content-integration.js');
                addTestResult(container, 'ContentIntegration 모듈 로드', true, '모듈 성공적으로 불러옴');
                
                const integration = new ContentIntegration();
                addTestResult(container, 'ContentIntegration 인스턴스 생성', !!integration, '인스턴스 생성 성공');

                // 콘텐츠 타입별 필터링 테스트
                const testData = [
                    { id: '1', type: 'faq', versions: { ko: { title: 'FAQ 1', content: 'FAQ 내용', published: true } } },
                    { id: '2', type: 'manual', versions: { ko: { title: '매뉴얼 1', content: '매뉴얼 내용', published: true } } },
                    { id: '3', type: 'faq', versions: { ko: { title: 'FAQ 2', content: 'FAQ 내용 2', published: false } } }
                ];

                integration.contentData = testData;
                const faqContent = integration.getContentByType('faq');
                addTestResult(container, '콘텐츠 타입 필터링', faqContent.length === 1, `${faqContent.length}개 발행된 FAQ 발견`);

                // 언어별 콘텐츠 로드 테스트  
                integration.language = 'ko';
                const koContent = integration.getContentByType('manual');
                addTestResult(container, '언어별 콘텐츠 로드', koContent.length === 1, '한국어 매뉴얼 로드 성공');

            } catch (error) {
                addTestResult(container, '콘텐츠 통합 시스템 오류', false, error.message);
            }
        };

        // 3. 실시간 동기화 테스트
        window.runSyncTests = async function() {
            const container = document.getElementById('syncTests');
            container.innerHTML = '';
            log('🔄 실시간 동기화 시스템 테스트 시작', 'info');

            try {
                // RealTimeContentSync 클래스 테스트
                const { RealTimeContentSync } = await import('./js/real-time-content-sync.js');
                addTestResult(container, 'RealTimeContentSync 모듈 로드', true, '모듈 성공적으로 불러옴');

                const syncManager = new RealTimeContentSync();
                addTestResult(container, 'RealTimeContentSync 인스턴스 생성', !!syncManager, '인스턴스 생성 성공');

                // 콘텐츠 해시 생성 테스트
                const testContent = [
                    { id: 'test1', type: 'faq', updatedAt: '2024-01-01', versions: { ko: {}, en: {} } }
                ];
                const hash1 = syncManager.generateContentHash(testContent);
                const hash2 = syncManager.generateContentHash(testContent);
                addTestResult(container, '콘텐츠 해시 일관성', hash1 === hash2, '동일한 콘텐츠에 대해 동일한 해시 생성');

                // 변경 감지 테스트
                const modifiedContent = [
                    { id: 'test1', type: 'faq', updatedAt: '2024-01-02', versions: { ko: {}, en: {} } }
                ];
                const hash3 = syncManager.generateContentHash(modifiedContent);
                addTestResult(container, '콘텐츠 변경 감지', hash1 !== hash3, '수정된 콘텐츠에 대해 다른 해시 생성');

                // 콜백 등록 테스트
                let callbackCalled = false;
                syncManager.onContentChange('faq', () => { callbackCalled = true; });
                addTestResult(container, '콜백 등록', syncManager.callbacks.has('faq'), 'FAQ 타입 콜백 등록 성공');

            } catch (error) {
                addTestResult(container, '실시간 동기화 오류', false, error.message);
            }
        };

        // 4. 다국어 지원 테스트
        window.runLanguageTests = async function() {
            const container = document.getElementById('languageTests');
            container.innerHTML = '';
            log('🌍 다국어 지원 시스템 테스트 시작', 'info');

            const supportedLanguages = ['ko', 'en', 'ja', 'zh', 'es'];
            
            try {
                // 지원 언어 테스트
                addTestResult(container, '지원 언어 확인', 
                    supportedLanguages.length >= 5, 
                    `${supportedLanguages.length}개 언어 지원`);

                // 다국어 콘텐츠 구조 테스트
                const multilingualContent = {
                    id: 'ml-test-1',
                    type: 'guide',
                    versions: {}
                };

                supportedLanguages.forEach(lang => {
                    multilingualContent.versions[lang] = {
                        title: `Title in ${lang}`,
                        content: `Content in ${lang}`,
                        published: true,
                        translationStatus: 'updated'
                    };
                });

                addTestResult(container, '다국어 버전 생성', 
                    Object.keys(multilingualContent.versions).length === supportedLanguages.length,
                    `전체 ${supportedLanguages.length}개 언어 버전 생성`);

                // 번역 상태 추적 테스트
                const translationStatuses = Object.values(multilingualContent.versions)
                    .map(v => v.translationStatus);
                const allUpdated = translationStatuses.every(status => status === 'updated');
                addTestResult(container, '번역 상태 일관성', allUpdated, '모든 언어 버전이 최신 상태');

                // 언어별 발행 상태 테스트
                multilingualContent.versions.en.published = false;
                const publishedVersions = Object.values(multilingualContent.versions)
                    .filter(v => v.published).length;
                addTestResult(container, '언어별 발행 상태 관리', 
                    publishedVersions === supportedLanguages.length - 1,
                    `${publishedVersions}개 언어 발행됨`);

            } catch (error) {
                addTestResult(container, '다국어 지원 오류', false, error.message);
            }
        };

        // 전체 테스트 실행
        window.runAllTests = async function() {
            log('🎯 전체 테스트 suite 실행 시작', 'info');
            
            // 결과 초기화
            testResults = { passed: 0, failed: 0, total: 0 };
            updateSummary();
            
            await runAdminTests();
            await runIntegrationTests();
            await runSyncTests();
            await runLanguageTests();
            
            const successRate = ((testResults.passed / testResults.total) * 100).toFixed(1);
            log(`📊 전체 테스트 완료 - 성공률: ${successRate}% (${testResults.passed}/${testResults.total})`, 
                successRate >= 90 ? 'success' : successRate >= 70 ? 'warning' : 'error');
        };

        // 로그 지우기
        window.clearLog = function() {
            document.getElementById('testLog').innerHTML = '<div class="text-gray-500">테스트 로그가 여기에 표시됩니다...</div>';
        };

        // 초기화
        log('🔧 테스트 환경 준비 완료', 'info');
    </script>
</body>
</html>