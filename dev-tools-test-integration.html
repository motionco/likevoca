<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‹¤êµ­ì–´ ì½˜í…ì¸  ê´€ë¦¬ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-4xl font-bold text-center mb-12 text-gray-800">
            <i class="fas fa-flask text-blue-600 mr-3"></i>
            ë‹¤êµ­ì–´ ì½˜í…ì¸  ê´€ë¦¬ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
        </h1>

        <!-- í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½ -->
        <div id="testSummary" class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-semibold mb-4">
                <i class="fas fa-chart-bar text-green-600 mr-2"></i>
                í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½
            </h2>
            <div class="grid grid-cols-3 gap-4 text-center">
                <div class="bg-green-100 rounded-lg p-4">
                    <div class="text-3xl font-bold text-green-600" id="passedTests">0</div>
                    <div class="text-green-700">í†µê³¼</div>
                </div>
                <div class="bg-red-100 rounded-lg p-4">
                    <div class="text-3xl font-bold text-red-600" id="failedTests">0</div>
                    <div class="text-red-700">ì‹¤íŒ¨</div>
                </div>
                <div class="bg-blue-100 rounded-lg p-4">
                    <div class="text-3xl font-bold text-blue-600" id="totalTests">0</div>
                    <div class="text-blue-700">ì „ì²´</div>
                </div>
            </div>
        </div>

        <!-- í…ŒìŠ¤íŠ¸ ì¹´í…Œê³ ë¦¬ -->
        <div class="space-y-8">
            <!-- 1. ê´€ë¦¬ì ì½˜í…ì¸  ê´€ë¦¬ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold mb-4">
                    <i class="fas fa-cog text-purple-600 mr-2"></i>
                    1. ê´€ë¦¬ì ì½˜í…ì¸  ê´€ë¦¬ ì‹œìŠ¤í…œ
                </h3>
                <div id="adminTests" class="space-y-2">
                    <!-- í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
                <button onclick="runAdminTests()" class="mt-4 bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700">
                    <i class="fas fa-play mr-2"></i>
                    ê´€ë¦¬ì ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
                </button>
            </div>

            <!-- 2. ì½˜í…ì¸  í†µí•© ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold mb-4">
                    <i class="fas fa-puzzle-piece text-orange-600 mr-2"></i>
                    2. ì½˜í…ì¸  í†µí•© ì‹œìŠ¤í…œ
                </h3>
                <div id="integrationTests" class="space-y-2">
                    <!-- í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
                <button onclick="runIntegrationTests()" class="mt-4 bg-orange-600 text-white px-6 py-2 rounded-lg hover:bg-orange-700">
                    <i class="fas fa-play mr-2"></i>
                    í†µí•© ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
                </button>
            </div>

            <!-- 3. ì‹¤ì‹œê°„ ë™ê¸°í™” í…ŒìŠ¤íŠ¸ -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold mb-4">
                    <i class="fas fa-sync-alt text-blue-600 mr-2"></i>
                    3. ì‹¤ì‹œê°„ ë™ê¸°í™” ì‹œìŠ¤í…œ
                </h3>
                <div id="syncTests" class="space-y-2">
                    <!-- í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
                <button onclick="runSyncTests()" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                    <i class="fas fa-play mr-2"></i>
                    ë™ê¸°í™” í…ŒìŠ¤íŠ¸ ì‹¤í–‰
                </button>
            </div>

            <!-- 4. ë‹¤êµ­ì–´ ì§€ì› í…ŒìŠ¤íŠ¸ -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold mb-4">
                    <i class="fas fa-globe text-green-600 mr-2"></i>
                    4. ë‹¤êµ­ì–´ ì§€ì› ì‹œìŠ¤í…œ
                </h3>
                <div id="languageTests" class="space-y-2">
                    <!-- í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
                <button onclick="runLanguageTests()" class="mt-4 bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">
                    <i class="fas fa-play mr-2"></i>
                    ë‹¤êµ­ì–´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
                </button>
            </div>
        </div>

        <!-- ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë²„íŠ¼ -->
        <div class="text-center mt-8">
            <button onclick="runAllTests()" class="bg-gray-800 text-white px-12 py-4 rounded-lg text-lg font-semibold hover:bg-gray-900">
                <i class="fas fa-rocket mr-2"></i>
                ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
            </button>
        </div>

        <!-- í…ŒìŠ¤íŠ¸ ë¡œê·¸ -->
        <div class="bg-black text-green-400 rounded-lg p-4 mt-8 font-mono text-sm">
            <div class="flex items-center justify-between mb-2">
                <h4 class="font-bold">í…ŒìŠ¤íŠ¸ ë¡œê·¸</h4>
                <button onclick="clearLog()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-trash mr-1"></i>
                    ì§€ìš°ê¸°
                </button>
            </div>
            <div id="testLog" class="max-h-96 overflow-y-auto">
                <div class="text-gray-500">í…ŒìŠ¤íŠ¸ ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
            </div>
        </div>
    </div>

    <script type="module">
        // í…ŒìŠ¤íŠ¸ ìƒíƒœ ë³€ìˆ˜
        let testResults = {
            passed: 0,
            failed: 0,
            total: 0
        };

        // ë¡œê·¸ í•¨ìˆ˜
        function log(message, type = 'info') {
            const logDiv = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: 'text-green-400',
                success: 'text-green-300',
                error: 'text-red-400',
                warning: 'text-yellow-400'
            };
            
            logDiv.innerHTML += `<div class="${colors[type]}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì¶”ê°€
        function addTestResult(container, testName, passed, details = '') {
            const resultDiv = document.createElement('div');
            resultDiv.className = `flex items-center justify-between p-3 rounded-lg ${passed ? 'bg-green-50 text-green-800' : 'bg-red-50 text-red-800'}`;
            
            resultDiv.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${passed ? 'check' : 'times'} mr-2"></i>
                    <span>${testName}</span>
                </div>
                <div class="text-sm">${details}</div>
            `;
            
            container.appendChild(resultDiv);
            
            // ê²°ê³¼ ì—…ë°ì´íŠ¸
            if (passed) {
                testResults.passed++;
                log(`âœ… ${testName} - í†µê³¼ ${details ? '(' + details + ')' : ''}`, 'success');
            } else {
                testResults.failed++;
                log(`âŒ ${testName} - ì‹¤íŒ¨ ${details ? '(' + details + ')' : ''}`, 'error');
            }
            testResults.total++;
            updateSummary();
        }

        // ìš”ì•½ ì—…ë°ì´íŠ¸
        function updateSummary() {
            document.getElementById('passedTests').textContent = testResults.passed;
            document.getElementById('failedTests').textContent = testResults.failed;
            document.getElementById('totalTests').textContent = testResults.total;
        }

        // 1. ê´€ë¦¬ì ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
        window.runAdminTests = async function() {
            const container = document.getElementById('adminTests');
            container.innerHTML = '';
            log('ğŸš€ ê´€ë¦¬ì ì½˜í…ì¸  ê´€ë¦¬ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì‹œì‘', 'info');

            try {
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í…ŒìŠ¤íŠ¸
                localStorage.setItem('test_multilingual_content', JSON.stringify([{
                    id: 'test-content-1',
                    type: 'faq',
                    priority: 'high',
                    versions: {
                        ko: { title: 'í…ŒìŠ¤íŠ¸ ì§ˆë¬¸', content: 'í…ŒìŠ¤íŠ¸ ë‹µë³€', published: true, translationStatus: 'updated' }
                    }
                }]));
                addTestResult(container, 'ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì €ì¥/ì½ê¸°', true, 'í…ŒìŠ¤íŠ¸ ì½˜í…ì¸  ì €ì¥ ì„±ê³µ');

                // ë‹¤êµ­ì–´ ì½˜í…ì¸  ìƒì„± í…ŒìŠ¤íŠ¸
                const testContent = {
                    id: 'test-multilang-1',
                    type: 'manual',
                    priority: 'medium',
                    versions: {
                        ko: { title: 'í•œêµ­ì–´ ì œëª©', content: 'í•œêµ­ì–´ ë‚´ìš©', published: true, translationStatus: 'updated' },
                        en: { title: 'English Title', content: 'English Content', published: true, translationStatus: 'updated' }
                    },
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                addTestResult(container, 'ë‹¤êµ­ì–´ ì½˜í…ì¸  êµ¬ì¡° ê²€ì¦', 
                    Object.keys(testContent.versions).length >= 2, 
                    `${Object.keys(testContent.versions).length}ê°œ ì–¸ì–´`);

                // ë²ˆì—­ ìƒíƒœ ê´€ë¦¬ í…ŒìŠ¤íŠ¸
                const translationStatuses = ['updated', 'outdated', 'missing'];
                const validStatus = translationStatuses.includes(testContent.versions.ko.translationStatus);
                addTestResult(container, 'ë²ˆì—­ ìƒíƒœ ê´€ë¦¬', validStatus, testContent.versions.ko.translationStatus);

            } catch (error) {
                addTestResult(container, 'ê´€ë¦¬ì ì‹œìŠ¤í…œ ì˜¤ë¥˜', false, error.message);
            }
        };

        // 2. ì½˜í…ì¸  í†µí•© ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
        window.runIntegrationTests = async function() {
            const container = document.getElementById('integrationTests');
            container.innerHTML = '';
            log('ğŸ”— ì½˜í…ì¸  í†µí•© ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì‹œì‘', 'info');

            try {
                // ContentIntegration í´ë˜ìŠ¤ í…ŒìŠ¤íŠ¸
                const { ContentIntegration } = await import('./js/content-integration.js');
                addTestResult(container, 'ContentIntegration ëª¨ë“ˆ ë¡œë“œ', true, 'ëª¨ë“ˆ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì˜´');
                
                const integration = new ContentIntegration();
                addTestResult(container, 'ContentIntegration ì¸ìŠ¤í„´ìŠ¤ ìƒì„±', !!integration, 'ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì„±ê³µ');

                // ì½˜í…ì¸  íƒ€ì…ë³„ í•„í„°ë§ í…ŒìŠ¤íŠ¸
                const testData = [
                    { id: '1', type: 'faq', versions: { ko: { title: 'FAQ 1', content: 'FAQ ë‚´ìš©', published: true } } },
                    { id: '2', type: 'manual', versions: { ko: { title: 'ë§¤ë‰´ì–¼ 1', content: 'ë§¤ë‰´ì–¼ ë‚´ìš©', published: true } } },
                    { id: '3', type: 'faq', versions: { ko: { title: 'FAQ 2', content: 'FAQ ë‚´ìš© 2', published: false } } }
                ];

                integration.contentData = testData;
                const faqContent = integration.getContentByType('faq');
                addTestResult(container, 'ì½˜í…ì¸  íƒ€ì… í•„í„°ë§', faqContent.length === 1, `${faqContent.length}ê°œ ë°œí–‰ëœ FAQ ë°œê²¬`);

                // ì–¸ì–´ë³„ ì½˜í…ì¸  ë¡œë“œ í…ŒìŠ¤íŠ¸  
                integration.language = 'ko';
                const koContent = integration.getContentByType('manual');
                addTestResult(container, 'ì–¸ì–´ë³„ ì½˜í…ì¸  ë¡œë“œ', koContent.length === 1, 'í•œêµ­ì–´ ë§¤ë‰´ì–¼ ë¡œë“œ ì„±ê³µ');

            } catch (error) {
                addTestResult(container, 'ì½˜í…ì¸  í†µí•© ì‹œìŠ¤í…œ ì˜¤ë¥˜', false, error.message);
            }
        };

        // 3. ì‹¤ì‹œê°„ ë™ê¸°í™” í…ŒìŠ¤íŠ¸
        window.runSyncTests = async function() {
            const container = document.getElementById('syncTests');
            container.innerHTML = '';
            log('ğŸ”„ ì‹¤ì‹œê°„ ë™ê¸°í™” ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì‹œì‘', 'info');

            try {
                // RealTimeContentSync í´ë˜ìŠ¤ í…ŒìŠ¤íŠ¸
                const { RealTimeContentSync } = await import('./js/real-time-content-sync.js');
                addTestResult(container, 'RealTimeContentSync ëª¨ë“ˆ ë¡œë“œ', true, 'ëª¨ë“ˆ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì˜´');

                const syncManager = new RealTimeContentSync();
                addTestResult(container, 'RealTimeContentSync ì¸ìŠ¤í„´ìŠ¤ ìƒì„±', !!syncManager, 'ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì„±ê³µ');

                // ì½˜í…ì¸  í•´ì‹œ ìƒì„± í…ŒìŠ¤íŠ¸
                const testContent = [
                    { id: 'test1', type: 'faq', updatedAt: '2024-01-01', versions: { ko: {}, en: {} } }
                ];
                const hash1 = syncManager.generateContentHash(testContent);
                const hash2 = syncManager.generateContentHash(testContent);
                addTestResult(container, 'ì½˜í…ì¸  í•´ì‹œ ì¼ê´€ì„±', hash1 === hash2, 'ë™ì¼í•œ ì½˜í…ì¸ ì— ëŒ€í•´ ë™ì¼í•œ í•´ì‹œ ìƒì„±');

                // ë³€ê²½ ê°ì§€ í…ŒìŠ¤íŠ¸
                const modifiedContent = [
                    { id: 'test1', type: 'faq', updatedAt: '2024-01-02', versions: { ko: {}, en: {} } }
                ];
                const hash3 = syncManager.generateContentHash(modifiedContent);
                addTestResult(container, 'ì½˜í…ì¸  ë³€ê²½ ê°ì§€', hash1 !== hash3, 'ìˆ˜ì •ëœ ì½˜í…ì¸ ì— ëŒ€í•´ ë‹¤ë¥¸ í•´ì‹œ ìƒì„±');

                // ì½œë°± ë“±ë¡ í…ŒìŠ¤íŠ¸
                let callbackCalled = false;
                syncManager.onContentChange('faq', () => { callbackCalled = true; });
                addTestResult(container, 'ì½œë°± ë“±ë¡', syncManager.callbacks.has('faq'), 'FAQ íƒ€ì… ì½œë°± ë“±ë¡ ì„±ê³µ');

            } catch (error) {
                addTestResult(container, 'ì‹¤ì‹œê°„ ë™ê¸°í™” ì˜¤ë¥˜', false, error.message);
            }
        };

        // 4. ë‹¤êµ­ì–´ ì§€ì› í…ŒìŠ¤íŠ¸
        window.runLanguageTests = async function() {
            const container = document.getElementById('languageTests');
            container.innerHTML = '';
            log('ğŸŒ ë‹¤êµ­ì–´ ì§€ì› ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì‹œì‘', 'info');

            const supportedLanguages = ['ko', 'en', 'ja', 'zh', 'es'];
            
            try {
                // ì§€ì› ì–¸ì–´ í…ŒìŠ¤íŠ¸
                addTestResult(container, 'ì§€ì› ì–¸ì–´ í™•ì¸', 
                    supportedLanguages.length >= 5, 
                    `${supportedLanguages.length}ê°œ ì–¸ì–´ ì§€ì›`);

                // ë‹¤êµ­ì–´ ì½˜í…ì¸  êµ¬ì¡° í…ŒìŠ¤íŠ¸
                const multilingualContent = {
                    id: 'ml-test-1',
                    type: 'guide',
                    versions: {}
                };

                supportedLanguages.forEach(lang => {
                    multilingualContent.versions[lang] = {
                        title: `Title in ${lang}`,
                        content: `Content in ${lang}`,
                        published: true,
                        translationStatus: 'updated'
                    };
                });

                addTestResult(container, 'ë‹¤êµ­ì–´ ë²„ì „ ìƒì„±', 
                    Object.keys(multilingualContent.versions).length === supportedLanguages.length,
                    `ì „ì²´ ${supportedLanguages.length}ê°œ ì–¸ì–´ ë²„ì „ ìƒì„±`);

                // ë²ˆì—­ ìƒíƒœ ì¶”ì  í…ŒìŠ¤íŠ¸
                const translationStatuses = Object.values(multilingualContent.versions)
                    .map(v => v.translationStatus);
                const allUpdated = translationStatuses.every(status => status === 'updated');
                addTestResult(container, 'ë²ˆì—­ ìƒíƒœ ì¼ê´€ì„±', allUpdated, 'ëª¨ë“  ì–¸ì–´ ë²„ì „ì´ ìµœì‹  ìƒíƒœ');

                // ì–¸ì–´ë³„ ë°œí–‰ ìƒíƒœ í…ŒìŠ¤íŠ¸
                multilingualContent.versions.en.published = false;
                const publishedVersions = Object.values(multilingualContent.versions)
                    .filter(v => v.published).length;
                addTestResult(container, 'ì–¸ì–´ë³„ ë°œí–‰ ìƒíƒœ ê´€ë¦¬', 
                    publishedVersions === supportedLanguages.length - 1,
                    `${publishedVersions}ê°œ ì–¸ì–´ ë°œí–‰ë¨`);

            } catch (error) {
                addTestResult(container, 'ë‹¤êµ­ì–´ ì§€ì› ì˜¤ë¥˜', false, error.message);
            }
        };

        // ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        window.runAllTests = async function() {
            log('ğŸ¯ ì „ì²´ í…ŒìŠ¤íŠ¸ suite ì‹¤í–‰ ì‹œì‘', 'info');
            
            // ê²°ê³¼ ì´ˆê¸°í™”
            testResults = { passed: 0, failed: 0, total: 0 };
            updateSummary();
            
            await runAdminTests();
            await runIntegrationTests();
            await runSyncTests();
            await runLanguageTests();
            
            const successRate = ((testResults.passed / testResults.total) * 100).toFixed(1);
            log(`ğŸ“Š ì „ì²´ í…ŒìŠ¤íŠ¸ ì™„ë£Œ - ì„±ê³µë¥ : ${successRate}% (${testResults.passed}/${testResults.total})`, 
                successRate >= 90 ? 'success' : successRate >= 70 ? 'warning' : 'error');
        };

        // ë¡œê·¸ ì§€ìš°ê¸°
        window.clearLog = function() {
            document.getElementById('testLog').innerHTML = '<div class="text-gray-500">í…ŒìŠ¤íŠ¸ ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>';
        };

        // ì´ˆê¸°í™”
        log('ğŸ”§ í…ŒìŠ¤íŠ¸ í™˜ê²½ ì¤€ë¹„ ì™„ë£Œ', 'info');
    </script>
</body>
</html>